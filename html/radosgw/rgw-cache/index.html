

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>RGW Data Caching and CDN &mdash; Ceph Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Ceph 对象网关 Swift API" href="../swift/" />
    <link rel="prev" title="Ceph Object Gateway IAM API" href="../iam/" /> 
</head>

<body class="wy-body-for-nav">

   
  <header class="top-bar">
    <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../">Ceph 对象网关</a></li>
      <li class="breadcrumb-item active">RGW Data Caching and CDN</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/radosgw/rgw-cache.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
  </header>
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #eee" >
          

          
            <a href="../../" class="icon icon-home"> Ceph
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph 对象网关</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../frontends/">HTTP 前端</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multisite/">多站配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zone-features/">域的功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../placement/">存储池归置与存储类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multisite-sync-policy/">多站同步策略配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pools/">存储池的配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config-ref/">配置参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="../admin/">管理指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../account/">用户账户</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s3/">S3 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iam/">IAM API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">数据缓存和 CDN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#new-apis">New APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#auth-api">Auth API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cache-api">Cache API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-nginx-with-rgw">Using Nginx with RGW</a></li>
<li class="toctree-l3"><a class="reference internal" href="#appendix">Appendix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../swift/">Swift API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adminops/">管理操作 API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/">Python 接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfs/">通过 NFS 导出</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keystone/">与 OpenStack Keystone 对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../barbican/">与 OpenStack Barbican 对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault/">与 HashiCorp Vault 对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kmip/">与 KMIP 对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../opa/">与 Open Policy Agent 对接</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multitenancy/">多租户</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compression/">压缩</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ldap-auth/">LDAP 认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../encryption/">服务器端加密</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bucketpolicy/">桶策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamicresharding/">动态的桶索引重分片</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mfa/">多因子认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sync-modules/">同步模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notifications/">Bucket Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layout/">RADOS 中的数据布局</a></li>
<li class="toctree-l2"><a class="reference internal" href="../STS/">STS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../STSLite/">STS Lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keycloak/">Keycloak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../session-tags/">Session Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../role/">Role</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orphans/">Orphan List and Associated Tooliing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oidc/">OpenID Connect Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/">故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw/">radosgw 手册页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../man/8/radosgw-admin/">radosgw-admin 手册页</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qat-accel/">使用 QAT 为加密和压缩提速</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s3select/">S3-select</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lua-scripting/">Lua Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../d3n_datacache/">D3N Data Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cloud-transition/">Cloud Transition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cloud-restore/">Cloud Restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics/">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uadk-accel/">UADK Acceleration for Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bucket_logging/">桶的日志记录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../s3_objects_dedup/">全文对象去重</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../monitoring/">监控概览</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crimson/crimson/">Crimson (Tech Preview)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/">Ceph 版本（索引）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware-monitoring/">硬件监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jaegertracing/">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation_cn/">中文版翻译资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Ceph</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
<div id="dev-warning" class="admonition note">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="padding: 5px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="rgw-data-caching-and-cdn">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">RGW Data Caching and CDN</a><a class="headerlink" href="#rgw-data-caching-and-cdn" title="Permalink to this heading"></a></h1>
<div class="versionadded">
<p><span class="versionmodified added">New in version Octopus.</span></p>
</div>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#rgw-data-caching-and-cdn" id="id1">RGW Data Caching and CDN</a></p>
<ul>
<li><p><a class="reference internal" href="#new-apis" id="id2">New APIs</a></p>
<ul>
<li><p><a class="reference internal" href="#auth-api" id="id3">Auth API</a></p></li>
<li><p><a class="reference internal" href="#cache-api" id="id4">Cache API</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-nginx-with-rgw" id="id5">Using Nginx with RGW</a></p></li>
<li><p><a class="reference internal" href="#appendix" id="id6">Appendix</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>This feature adds to RGW the ability to securely cache objects and offload the workload from the cluster, using Nginx.
After an object is accessed the first time it will be stored in the Nginx cache directory.
When data is already cached, it need not be fetched from RGW. A permission check will be made against RGW to ensure the requesting user has access.
This feature is based on the Nginx modules <code class="docutils literal notranslate"><span class="pre">ngx_http_auth_request_module</span></code> and <a class="reference external" href="https://github.com/kaltura/nginx-aws-auth-module">nginx-aws-auth-module</a>, and OpenResty for Lua capabilities.</p>
<p>Currently this feature will cache only AWSv4 requests (only S3 requests), caching-in the output of the first GET request
and caching-out on subsequent GET requests, passing through transparently PUT,POST,HEAD,DELETE and COPY requests.</p>
<p>The feature introduces 2 new APIs: Auth and Cache.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference external" href="../d3n_datacache/">D3N RGW Data Cache</a> is an alternative data caching mechanism implemented natively in the RADOS Gateway.</p>
</div>
<section id="new-apis">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">New APIs</a><a class="headerlink" href="#new-apis" title="Permalink to this heading"></a></h2>
<p>There are 2 new APIs for this feature:</p>
<ul class="simple">
<li><p><strong>Auth API:</strong> The cache uses this to validate that a user can access the cached data.</p></li>
<li><p><strong>Cache API:</strong> Adds the ability to override securely <code class="docutils literal notranslate"><span class="pre">Range</span></code> header so that Nginx can use its own <a class="reference external" href="https://www.nginx.com/blog/smart-efficient-byte-range-caching-nginx/">smart cache</a> on top of S3.
Using this API gives the ability to read ahead objects when client is asking a specific range from the object.
On subsequent accesses to the cached object, Nginx will satisfy requests for already-cached ranges from the cache. Uncached ranges will be read from RGW (and cached).</p></li>
</ul>
<section id="auth-api">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Auth API</a><a class="headerlink" href="#auth-api" title="Permalink to this heading"></a></h3>
<p>This API validates a specific authenticated access being made to the cache, using RGW’s knowledge of the client credentials and stored access policy.
Returns success if the encapsulated request would be granted.</p>
</section>
<section id="cache-api">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Cache API</a><a class="headerlink" href="#cache-api" title="Permalink to this heading"></a></h3>
<p>This API is meant to allow changing signed <code class="docutils literal notranslate"><span class="pre">Range</span></code> headers using a privileged cache user.</p>
<p>Creating the cache user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "# ";
}
</style><span class="prompt1">radosgw-admin<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>--uid<span class="o">=</span>&lt;uid<span class="w"> </span><span class="k">for</span><span class="w"> </span>cache<span class="w"> </span>user&gt;<span class="w"> </span>--display-name<span class="o">=</span><span class="s2">&quot;cache user&quot;</span><span class="w"> </span>--caps<span class="o">=</span><span class="s2">&quot;amz-cache=read&quot;</span></span>
</pre></div></div><p>This user can send to the RGW the Cache API header <code class="docutils literal notranslate"><span class="pre">X-Amz-Cache</span></code>. This header contains the headers from the original request (before changing the <code class="docutils literal notranslate"><span class="pre">Range</span></code> header):</p>
<ul class="simple">
<li><p>Original headers are separated from each other by a character with ASCII code 177 decimal.</p></li>
<li><p>Each original header and its value are separated by a character with ASCII code 178 decimal.</p></li>
</ul>
<p>The RGW will check that the user is an authorized user and that the value is a cache user.
If both checks succeed it will use the <code class="docutils literal notranslate"><span class="pre">X-Amz-Cache</span></code> to revalidate that the user has permissions, using the original headers stored in the <code class="docutils literal notranslate"><span class="pre">X-Amz-Cache</span></code> header.
During this flow the RGW will override the <code class="docutils literal notranslate"><span class="pre">Range</span></code> header.</p>
</section>
</section>
<section id="using-nginx-with-rgw">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Using Nginx with RGW</a><a class="headerlink" href="#using-nginx-with-rgw" title="Permalink to this heading"></a></h2>
<p>Download the source of OpenResty:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt2:before {
  content: "$ ";
}
</style><span class="prompt2">wget<span class="w"> </span>https://openresty.org/download/openresty-1.15.8.3.tar.gz</span>
</pre></div></div><p>Use git to clone the Nginx AWS authentication module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt2">git<span class="w"> </span>clone<span class="w"> </span>https://github.com/kaltura/nginx-aws-auth-module</span>
</pre></div></div><p>Untar the OpenResty package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt2">tar<span class="w"> </span>xvzf<span class="w"> </span>openresty-1.15.8.3.tar.gz</span>
<span class="prompt2"><span class="nb">cd</span><span class="w"> </span>openresty-1.15.8.3</span>
</pre></div></div><p>Compile OpenResty, make sure that you have <code class="docutils literal notranslate"><span class="pre">pcre</span></code> library and <code class="docutils literal notranslate"><span class="pre">openssl</span></code> library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt2">sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>pcre-devel<span class="w"> </span>openssl-devel<span class="w"> </span>gcc<span class="w"> </span>curl<span class="w"> </span>zlib-devel<span class="w"> </span>nginx</span>
<span class="prompt2">./configure<span class="w"> </span>--add-module<span class="o">=</span>&lt;the<span class="w"> </span>nginx-aws-auth-module<span class="w"> </span>dir&gt;<span class="w"> </span>--with-http_auth_request_module<span class="w"> </span>--with-http_slice_module<span class="w"> </span>--conf-path<span class="o">=</span>/etc/nginx/nginx.conf</span>
<span class="prompt2">gmake<span class="w"> </span>-j<span class="w"> </span><span class="k">$(</span>nproc<span class="k">)</span></span>
<span class="prompt2">sudo<span class="w"> </span>gmake<span class="w"> </span>install</span>
<span class="prompt2">sudo<span class="w"> </span>ln<span class="w"> </span>-sf<span class="w"> </span>/usr/local/openresty/bin/openresty<span class="w"> </span>/usr/bin/nginx</span>
</pre></div></div><p>Put in-place your Nginx configuration files and edit them according to your environment:</p>
<p>Example Nginx configuration files are available at
<a class="reference external" href="https://github.com/ceph/ceph/tree/main/examples/rgw/rgw-cache">https://github.com/ceph/ceph/tree/main/examples/rgw/rgw-cache</a></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code> should go to <code class="docutils literal notranslate"><span class="pre">/etc/nginx/nginx.conf</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nginx-lua-file.lua</span></code> should go to <code class="docutils literal notranslate"><span class="pre">/etc/nginx/nginx-lua-file.lua</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nginx-default.conf</span></code> should go to <code class="docutils literal notranslate"><span class="pre">/etc/nginx/conf.d/nginx-default.conf</span></code>.</p></li>
</ul>
<p>The parameters that are most likely to require adjustment according to the environment are located in the file <code class="docutils literal notranslate"><span class="pre">nginx-default.conf</span></code>.</p>
<p>Modify the example values of <code class="docutils literal notranslate"><span class="pre">proxy_cache_path</span></code> and <code class="docutils literal notranslate"><span class="pre">max_size</span></code> at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proxy_cache_path</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">cache</span> <span class="n">levels</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span> <span class="n">keys_zone</span><span class="o">=</span><span class="n">mycache</span><span class="p">:</span><span class="mi">999</span><span class="n">m</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">20</span><span class="n">G</span> <span class="n">inactive</span><span class="o">=</span><span class="mi">1</span><span class="n">d</span> <span class="n">use_temp_path</span><span class="o">=</span><span class="n">off</span><span class="p">;</span>
</pre></div>
</div>
<p>And modify the example <code class="docutils literal notranslate"><span class="pre">server</span></code> values to point to the RGWs URIs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">server</span> <span class="n">rgw1</span><span class="p">:</span><span class="mi">8000</span> <span class="n">max_fails</span><span class="o">=</span><span class="mi">2</span> <span class="n">fail_timeout</span><span class="o">=</span><span class="mi">5</span><span class="n">s</span><span class="p">;</span>
<span class="n">server</span> <span class="n">rgw2</span><span class="p">:</span><span class="mi">8000</span> <span class="n">max_fails</span><span class="o">=</span><span class="mi">2</span> <span class="n">fail_timeout</span><span class="o">=</span><span class="mi">5</span><span class="n">s</span><span class="p">;</span>
<span class="n">server</span> <span class="n">rgw3</span><span class="p">:</span><span class="mi">8000</span> <span class="n">max_fails</span><span class="o">=</span><span class="mi">2</span> <span class="n">fail_timeout</span><span class="o">=</span><span class="mi">5</span><span class="n">s</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">It is important to substitute the <em>access key</em> and <em>secret key</em> located in the <code class="docutils literal notranslate"><span class="pre">nginx.conf</span></code> file with those belonging to the user with the <code class="docutils literal notranslate"><span class="pre">amz-cache</span></code> caps.</div>
<div class="line">For example, create the cache user as follows:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">radosgw-admin<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>--uid<span class="o">=</span>cacheuser<span class="w"> </span>--display-name<span class="o">=</span><span class="s2">&quot;cache user&quot;</span><span class="w"> </span>--caps<span class="o">=</span><span class="s2">&quot;amz-cache=read&quot;</span><span class="w"> </span>--access-key<span class="w"> </span>&lt;access&gt;<span class="w"> </span>--secret<span class="w"> </span>&lt;secret&gt;</span>
</pre></div></div><p>It is possible to use <a class="reference external" href="https://docs.nginx.com/nginx/admin-guide/content-cache/content-caching/#byte-range-caching">Nginx slicing</a> which is suitable for streaming purposes.</p>
<p>To enable slicing you should use <code class="docutils literal notranslate"><span class="pre">nginx-slicing.conf</span></code> instead of <code class="docutils literal notranslate"><span class="pre">nginx-default.conf</span></code>.</p>
<p>If you do not want to use prefetch caching, it is possible to replace <code class="docutils literal notranslate"><span class="pre">nginx-default.conf</span></code> with <code class="docutils literal notranslate"><span class="pre">nginx-noprefetch.conf</span></code>.
If prefetch caching is disabled Nginx will cache each range request separately and possible overlap in the range requests will be fetched more than once. For example, if a client is sending a range request of 0-4095 and then 0-4096 both requests are fetched completely from RGW.</p>
<p>Run Nginx (OpenResty):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>restart<span class="w"> </span>nginx</span>
</pre></div></div></section>
<section id="appendix">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this heading"></a></h2>
<p><strong>A note about performance:</strong> In certain instances such as a development environment, disabling authentication may (depending on the hardware) increase performance significantly as it forgoes auth API calls to RADOS Gateway.
This can be done by commenting the following line in <code class="docutils literal notranslate"><span class="pre">nginx-default.conf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#auth_request /authentication;</span>
</pre></div>
</div>
</section>
</section>



<div id="support-the-ceph-foundation" class="admonition note">
  <p class="first admonition-title">Brought to you by the Ceph Foundation</p>
  <p class="last">The Ceph Documentation is a community resource funded and hosted by the non-profit <a href="https://ceph.io/en/foundation/">Ceph Foundation</a>. If you would like to support this and our other efforts, please consider <a href="https://ceph.io/en/foundation/join/">joining now</a>.</p>
</div>


           </div>
           
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../iam/" class="btn btn-neutral float-left" title="Ceph Object Gateway IAM API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../swift/" class="btn btn-neutral float-right" title="Ceph 对象网关 Swift API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).</p>
  </div>

   

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>