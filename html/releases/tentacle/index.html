

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Tentacle &mdash; Ceph Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/ceph.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Squid" href="../squid/" />
    <link rel="prev" title="Ceph 版本（索引）" href="../" /> 
</head>

<body class="wy-body-for-nav">

   
  <header class="top-bar">
    <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../">Ceph 版本（索引）</a></li>
      <li class="breadcrumb-item active">Tentacle</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/releases/tentacle.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
  </header>
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #eee" >
          

          
            <a href="../../" class="icon icon-home"> Ceph
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/">Ceph 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">安装 Ceph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephadm/">Cephadm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rados/">Ceph 存储集群</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cephfs/">Ceph 文件系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rbd/">Ceph 块设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../radosgw/">Ceph 对象网关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/">Ceph 管理器守护进程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mgr/dashboard/">Ceph 仪表盘</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../monitoring/">监控概览</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API 文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">体系结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer_guide/">开发者指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/internals/">Ceph 内幕</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../governance/">项目管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../foundation/">Ceph 基金会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph-volume/">ceph-volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crimson/crimson/">Crimson (Tech Preview)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/">Ceph 版本（总目录）</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Ceph 版本（索引）</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../#active-releases">活跃版本</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Tentacle (v20.2.*)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#v20-2-0-tentacle">v20.2.0 Tentacle</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../squid/">Squid (v19.2.*)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reef/">Reef (v18.2.*)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../#id2">归档版本</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware-monitoring/">硬件监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Ceph 术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jaegertracing/">Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../translation_cn/">中文版翻译资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Ceph</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
<div id="dev-warning" class="admonition note">
  <p class="first admonition-title">Notice</p>
  <p class="last">This document is for a development version of Ceph.</p>
</div>
  <div id="docubetter" align="right" style="padding: 5px; font-weight: bold;">
    <a href="https://pad.ceph.com/p/Report_Documentation_Bugs">Report a Documentation Bug</a>
  </div>

  
  <section id="tentacle">
<h1>Tentacle<a class="headerlink" href="#tentacle" title="Permalink to this heading"></a></h1>
<p>Tentacle is the 20th stable release of Ceph.</p>
<section id="v20-2-0-tentacle">
<h2>v20.2.0 Tentacle<a class="headerlink" href="#v20-2-0-tentacle" title="Permalink to this heading"></a></h2>
<section id="release-date">
<h3>Release Date<a class="headerlink" href="#release-date" title="Permalink to this heading"></a></h3>
<p>November 18, 2025</p>
</section>
<section id="highlights">
<h3>Highlights<a class="headerlink" href="#highlights" title="Permalink to this heading"></a></h3>
<p><em>See the sections below for more details on these items.</em></p>
<p>CephFS</p>
<ul class="simple">
<li><p>Directories may now be configured with case-insensitive or normalized
directory entry names.</p></li>
<li><p>Modifying the FS setting variable <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> when a cluster is unhealthy
now requires users to pass the confirmation flag (<code class="docutils literal notranslate"><span class="pre">--yes-i-really-mean-it</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EOPNOTSUPP</span></code> (Operation not supported) is now returned by the CephFS FUSE
client for <code class="docutils literal notranslate"><span class="pre">fallocate</span></code> for the default case (i.e. <code class="docutils literal notranslate"><span class="pre">mode</span> <span class="pre">==</span> <span class="pre">0</span></code>).</p></li>
</ul>
<p>Dashboard</p>
<ul class="simple">
<li><p>Support has been added for NVMe/TCP gateway groups and multiple
namespaces, multi-cluster management, OAuth 2.0 integration, and enhanced
RGW/SMB features including multi-site automation, tiering, policies,
lifecycles, notifications, and granular replication.</p></li>
</ul>
<p>Integrated SMB support</p>
<ul class="simple">
<li><p>Ceph clusters now offer an SMB Manager module that works like the existing
NFS subsystem. The new SMB support allows the Ceph cluster to automatically
create Samba-backed SMB file shares connected to CephFS. The <code class="docutils literal notranslate"><span class="pre">smb</span></code> module
can configure both basic Active Directory domain or standalone user
authentication. The Ceph cluster can host one or more virtual SMB clusters
which can be truly clustered using Samba’s CTDB technology. The <code class="docutils literal notranslate"><span class="pre">smb</span></code>
module requires a cephadm-enabled Ceph cluster and deploys container images
provided by the <code class="docutils literal notranslate"><span class="pre">samba-container</span></code> project. The Ceph dashboard can be used
to configure SMB clusters and shares. A new <code class="docutils literal notranslate"><span class="pre">cephfs-proxy</span></code> daemon is
automatically deployed to improve scalability and memory usage when connecting
Samba to CephFS.</p></li>
</ul>
<p>MGR</p>
<ul class="simple">
<li><p>Users now have the ability to force-disable always-on modules.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">restful</span></code> and <code class="docutils literal notranslate"><span class="pre">zabbix</span></code> modules (deprecated since 2020) have been
officially removed.</p></li>
</ul>
<p>RADOS</p>
<ul class="simple">
<li><p>FastEC: Long-anticipated performance and space amplification
optimizations are added for erasure-coded pools.</p></li>
<li><p>BlueStore: Improved compression and a new, faster WAL (write-ahead-log).</p></li>
<li><p>Data Availability Score: Users can now track a data availability score
for each pool in their cluster.</p></li>
<li><p>OMAP: All components have been switched to the faster OMAP iteration
interface, which improves RGW bucket listing and scrub operations.</p></li>
</ul>
<p>Crimson</p>
<ul class="simple">
<li><p>SeaStore Tech Preview: SeaStore object store is now deployable
alongside Crimson-OSD, mainly for early testing and experimentation.
Community feedback is encouraged to help with future improvements.</p></li>
</ul>
<p>RBD</p>
<ul class="simple">
<li><p>New live migration features: RBD images can now be instantly imported
from another Ceph cluster (native format) or from a wide variety of
external sources/formats.</p></li>
<li><p>There is now support for RBD namespace remapping while mirroring between
Ceph clusters.</p></li>
<li><p>Several commands related to group and group snap info were added or
improved, and <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">device</span> <span class="pre">map</span></code> command now defaults to <code class="docutils literal notranslate"><span class="pre">msgr2</span></code>.</p></li>
</ul>
<p>RGW</p>
<ul>
<li><p>Added support for S3 <code class="docutils literal notranslate"><span class="pre">GetObjectAttributes</span></code>.</p></li>
<li><p>For compatibility with AWS S3, <code class="docutils literal notranslate"><span class="pre">LastModified</span></code> timestamps are now truncated
to the second. Note that during upgrade, users may observe these timestamps
moving backwards as a result.</p></li>
<li><p>Bucket resharding now does most of its processing before it starts to block
write operations. This should significantly reduce the client-visible impact
of resharding on large buckets.</p></li>
<li><p>RGW: The User Account feature introduced in Squid provides first-class support for
IAM APIs and policy. Our preliminary STS support was based on tenants, and
exposed some IAM APIs to admins only. This tenant-level IAM functionality is now
deprecated in favor of accounts. While we’ll continue to support the tenant feature
itself for namespace isolation, the following features will be removed no sooner
than the V release:</p>
<blockquote>
<div><ul class="simple">
<li><p>Tenant-level IAM APIs including CreateRole, PutRolePolicy and PutUserPolicy,</p></li>
<li><p>Use of tenant names instead of accounts in IAM policy documents,</p></li>
<li><p>Interpretation of IAM policy without cross-account policy evaluation,</p></li>
<li><p>S3 API support for cross-tenant names such as <cite>Bucket=’tenant:bucketname’</cite></p></li>
<li><p>STS Lite and <cite>sts:GetSessionToken</cite>.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="cephadm">
<h3>Cephadm<a class="headerlink" href="#cephadm" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>A new cephadm-managed <code class="docutils literal notranslate"><span class="pre">mgmt-gateway</span></code> service provides a single, TLS-terminated
entry point for Ceph management endpoints such as the Dashboard and the monitoring
stack. The gateway is implemented as an nginx-based reverse proxy that fronts Prometheus,
Grafana, and Alertmanager, so users no longer need to connect to those daemons directly or
know which hosts they run on. When combined with the new <code class="docutils literal notranslate"><span class="pre">oauth2-proxy</span></code> service, which
integrates with external identity providers using the OpenID Connect (OIDC) / OAuth 2.0
protocols, the gateway can enforce centralized authentication and single sign-on (SSO) for
both the Ceph Dashboard and the rest of the monitoring stack.</p></li>
<li><p>High availability for the Ceph Dashboard and the Prometheus-based monitoring stack is now
provided via the cephadm-managed <code class="docutils literal notranslate"><span class="pre">mgmt-gateway</span></code>. nginx high-availability mechanisms allow
the mgmt-gateway to detect healthy instances of the Dashboard, Prometheus, Grafana, and Alertmanager,
route traffic accordingly, and handle manager failover transparently. When deployed with a virtual
IP and multiple <code class="docutils literal notranslate"><span class="pre">mgmt-gateway</span></code> instances, this architecture keeps management access available
even during daemon or host failures.</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">certmgr</span></code> cephadm subsystem centralizes certificate lifecycle management for cephadm-managed
services. certmgr acts as a cluster-internal root CA for cephadm-signed certificates, it can also
consume user-provided certificates, and tracks how each certificate was provisioned. It standardizes
HTTPS configuration for services such as RGW and the mgmt-gateway, automates renewal and rotation of
cephadm-signed certificates, and raises health warnings when certificates are invalid, expiring or misconfigured.
With certmgr, cephadm-signed certificates are available across all cephadm-managed services, providing
secure defaults out of the box.</p></li>
</ul>
</section>
<section id="cephfs">
<h3>CephFS<a class="headerlink" href="#cephfs" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Directories may now be configured with case-insensitive or
normalized directory entry names. This is an inheritable configuration,
making it apply to an entire directory tree.</p>
<p>For more information, see <a class="reference internal" href="../../cephfs/charmap/#charmap"><span class="std std-ref">CephFS 目录条目名字规范化和大小写折叠</span></a>.</p>
</li>
<li><p>It is now possible to pause the threads that asynchronously purge
deleted subvolumes by using the config option
<code class="docutils literal notranslate"><span class="pre">mgr/volumes/pause_purging</span></code>.</p></li>
<li><p>It is now possible to pause the threads that asynchronously clone
subvolume snapshots by using the config option
<code class="docutils literal notranslate"><span class="pre">mgr/volumes/pause_cloning</span></code>.</p></li>
<li><p>Modifying the setting <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> when a cluster is
unhealthy now requires users to pass the confirmation flag
(<code class="docutils literal notranslate"><span class="pre">--yes-i-really-mean-it</span></code>). This has been added as a precaution to inform
users that modifying <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> may not help with troubleshooting or recovery
efforts. Instead, it might further destabilize the cluster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EOPNOTSUPP</span></code> (Operation not supported) is now returned by the CephFS
FUSE client for <code class="docutils literal notranslate"><span class="pre">fallocate</span></code> in the default case (i.e., <code class="docutils literal notranslate"><span class="pre">mode</span> <span class="pre">==</span> <span class="pre">0</span></code>) since
CephFS does not support disk space reservation. The only flags supported are
<code class="docutils literal notranslate"><span class="pre">FALLOC_FL_KEEP_SIZE</span></code> and <code class="docutils literal notranslate"><span class="pre">FALLOC_FL_PUNCH_HOLE</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">fs</span> <span class="pre">subvolume</span> <span class="pre">snapshot</span> <span class="pre">getpath</span></code> command now allows users
to get the path of a snapshot of a subvolume. If the snapshot is not present,
<code class="docutils literal notranslate"><span class="pre">ENOENT</span></code> is returned.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">fs</span> <span class="pre">volume</span> <span class="pre">create</span></code> command now allows users to pass
metadata and data pool names to be used for creating the volume. If either
is not passed, or if either is a non-empty pool, the command will abort.</p></li>
<li><p>The format of the pool namespace name for CephFS volumes has been changed
from <code class="docutils literal notranslate"><span class="pre">fsvolumens__&lt;subvol-name&gt;</span></code> to
<code class="docutils literal notranslate"><span class="pre">fsvolumens__&lt;subvol-grp-name&gt;_&lt;subvol-name&gt;</span></code> to avoid namespace collisions
when two subvolumes located in different subvolume groups have the same name.
Even with namespace collisions, there were no security issues, since the MDS
auth cap is restricted to the subvolume path. Now, with this change, the
namespaces are completely isolated.</p></li>
<li><p>If the subvolume name passed to the command <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">fs</span> <span class="pre">subvolume</span> <span class="pre">info</span></code>
is a clone, the output will now also contain a “source” field that tells the
user the name of the source snapshot along with the name of the volume,
subvolume group, and subvolume in which the source snapshot is located.
For clones created with Tentacle or an earlier release, the value of this
field will be <code class="docutils literal notranslate"><span class="pre">N/A</span></code>. Regular subvolumes do not have a source subvolume and
therefore the output for them will not contain a “source” field regardless of
the release.</p></li>
</ul>
</section>
<section id="crimson-seastore">
<h3>Crimson / SeaStore<a class="headerlink" href="#crimson-seastore" title="Permalink to this heading"></a></h3>
<p>The Crimson project continues to progress, with the Squid release marking the
first technical preview available for Crimson.
The Tentacle release introduces a host of improvements and new functionalities
that enhance the robustness, performance, and usability
of both Crimson-OSD and the SeaStore object store.
In this release, SeaStore can now be deployed alongside the Crimson-OSD!
Early testing and experimentation are highly encouraged and we’d greatly
appreciate any initial feedback rounds from the community to help guide future
improvements.
Check out the Crimson project updates blog post for Tentacle
where we highlight some of the work included in the latest release, moving us
closer to fully replacing the existing Classical OSD in the future:
<a class="reference external" href="https://ceph.io/en/news/blog/2025/crimson-T-release/">https://ceph.io/en/news/blog/2025/crimson-T-release/</a></p>
<p>If you’re new to the Crimson project, please visit the project
page for more information and resources: <a class="reference external" href="https://ceph.io/en/news/crimson">https://ceph.io/en/news/crimson</a></p>
</section>
<section id="dashboard">
<h3>Dashboard<a class="headerlink" href="#dashboard" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>There is now added support for NVMe/TCP gateway groups and multiple
namespaces, multi-cluster management, OAuth 2.0 integration, and enhanced
RGW/SMB features including multi-site automation, tiering, policies,
lifecycles, notifications, and granular replication.</p></li>
</ul>
</section>
<section id="mgr">
<h3>MGR<a class="headerlink" href="#mgr" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>The Ceph Manager’s always-on modulues/plugins can now be force-disabled.
This can be necessary in cases where we wish to prevent the manager from being
flooded by module commands when Ceph services are down or degraded.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mgr/restful</span></code>, <code class="docutils literal notranslate"><span class="pre">mgr/zabbix</span></code>: both modules, already deprecated since 2020, have been
finally removed. They have not been actively maintained in the last years,
and started suffering from vulnerabilities in their dependency chain (e.g.:
CVE-2023-46136). An alternative for the <code class="docutils literal notranslate"><span class="pre">restful</span></code> module is the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> module,
which provides a richer and better maintained RESTful API. Regarding the <code class="docutils literal notranslate"><span class="pre">zabbix</span></code> module,
there are alternative monitoring solutions, like <code class="docutils literal notranslate"><span class="pre">prometheus</span></code>, which is the most
widely adopted among the Ceph user community.</p></li>
</ul>
</section>
<section id="rados">
<h3>RADOS<a class="headerlink" href="#rados" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Long-anticipated performance and space amplification optimizations (FastEC)
are added for erasure-coded pools, including partial reads and partial writes.</p></li>
<li><p>A new implementation of the Erasure Coding I/O code provides substantial
performance improvements and some capacity improvements. The new code is
designed to optimize performance when using Erasure Coding with block storage
(RBD) and file storage (CephFS) but will have benefits for object storage
(RGW), in particular when using smaller sized objects. A new flag
<code class="docutils literal notranslate"><span class="pre">allow_ec_optimizations</span></code> must be set on each pool to switch to using the
new code. Existing pools can be upgraded once the OSD and Monitor daemons
have been updated. There is no need to update the clients.</p></li>
<li><p>The default plugin for erasure coded pools has been changed from Jerasure to
ISA-L. Clusters created on Tentacle or later releases will use ISA-L as the
default plugin when creating a new pool. Clusters that upgrade to the T release
will continue to use their existing default values. The default values can be
overridden by creating a new erasure code profile and selecting it when
creating a new pool. ISA-L is recommended for new pools because the Jerasure
library is no longer maintained.</p></li>
<li><p>BlueStore now has better compression and a new, faster WAL (write-ahead-log).</p></li>
<li><p>All components have been switched to the faster OMAP iteration interface, which
improves RGW bucket listing and scrub operations.</p></li>
<li><p>It is now possible to bypass <code class="docutils literal notranslate"><span class="pre">ceph_assert()</span></code> in extreme cases to help with
disaster recovery.</p></li>
<li><p>Testing improvements for dencoding verification were added.</p></li>
<li><p>A new command, <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">pool</span> <span class="pre">availability-status</span></code>, has been added that
allows users to view the availability score for each pool in a cluster. A pool
is considered unavailable if any PG in the pool is not <code class="docutils literal notranslate"><span class="pre">active</span></code> or if
there are unfound objects. Otherwise the pool is considered available. The
score is updated every one second by default. This interval can be changed
using the new config option <code class="docutils literal notranslate"><span class="pre">pool_availability_update_interval</span></code>. The feature
is off by default. A new config option <code class="docutils literal notranslate"><span class="pre">enable_availability_tracking</span></code> can be
used to turn on the feature if required. Another command is added to clear the
availability status for a specific pool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span> <span class="n">osd</span> <span class="n">pool</span> <span class="n">clear</span><span class="o">-</span><span class="n">availability</span><span class="o">-</span><span class="n">status</span> <span class="o">&lt;</span><span class="n">pool</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This feature is in tech preview.</p>
<p>Related links:</p>
<ul class="simple">
<li><p>Feature ticket: <a class="reference external" href="https://tracker.ceph.com/issues/67777">https://tracker.ceph.com/issues/67777</a></p></li>
<li><p>Documentation: <a class="reference internal" href="../../rados/operations/monitoring/#data-availability-score"><span class="std std-ref">跟踪一个集群的数据可用性评分</span></a></p></li>
</ul>
</li>
<li><p>Leader monitor and stretch mode status are now included in the <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">status</span></code>
output.</p>
<p>Related tracker: <a class="reference external" href="https://tracker.ceph.com/issues/70406">https://tracker.ceph.com/issues/70406</a></p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">df</span></code> command reports incorrect <code class="docutils literal notranslate"><span class="pre">MAX</span> <span class="pre">AVAIL</span></code> for stretch mode pools
when CRUSH rules use multiple take steps for datacenters. <code class="docutils literal notranslate"><span class="pre">PGMap::get_rule_avail</span></code>
incorrectly calculates available space from only one datacenter. As a workaround,
define CRUSH rules with <code class="docutils literal notranslate"><span class="pre">take</span> <span class="pre">default</span></code> and <code class="docutils literal notranslate"><span class="pre">choose</span> <span class="pre">firstn</span> <span class="pre">0</span> <span class="pre">type</span> <span class="pre">datacenter</span></code>.
See <a class="reference external" href="https://tracker.ceph.com/issues/56650#note-6">https://tracker.ceph.com/issues/56650#note-6</a> for details.</p>
<p>Upgrading a cluster configured with a CRUSH rule with multiple take steps can
lead to data shuffling, as the new CRUSH changes may necessitate data
redistribution. In contrast, a stretch rule with a single-take configuration
will not cause any data movement during the upgrade process.</p>
</li>
<li><p>Added convenience function <code class="docutils literal notranslate"><span class="pre">librados::AioCompletion::cancel()</span></code> with the same
behavior as <code class="docutils literal notranslate"><span class="pre">librados::IoCtx::aio_cancel()</span></code>.</p></li>
<li><p>The configuration parameter <code class="docutils literal notranslate"><span class="pre">osd_repair_during_recovery</span></code> has been removed.
That configuration flag used to control whether an operator-initiated “repair
scrub” would be allowed to start on an OSD that is performing a recovery. In
this Ceph version, operator-initiated scrubs and repair scrubs are never blocked
by a repair being performed.</p></li>
<li><p>Fixed issue of recovery/backfill hang due to improper handling of items in the
dmclock’s background clean-up thread.</p>
<p>Related tracker: <a class="reference external" href="https://tracker.ceph.com/issues/61594">https://tracker.ceph.com/issues/61594</a></p>
</li>
<li><p>The OSD’s IOPS capacity used by the mClock scheduler is now also checked to
determine if it’s below a configured threshold value defined by:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">osd_mclock_iops_capacity_low_threshold_hdd</span></code> – set to 50 IOPS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">osd_mclock_iops_capacity_low_threshold_ssd</span></code> – set to 1000 IOPS</p></li>
</ul>
<p>The check is intended to handle cases where the measured IOPS is unrealistically
low. If such a case is detected, the IOPS capacity is either set to the last
valid value or the configured default to avoid affecting cluster performance
(slow or stalled ops).</p>
</li>
<li><p>Documentation has been updated with steps to override OSD IOPS capacity
configuration.</p>
<p>Related links:</p>
<ul class="simple">
<li><p>Tracker ticket: <a class="reference external" href="https://tracker.ceph.com/issues/70774">https://tracker.ceph.com/issues/70774</a></p></li>
<li><p>Documentation: <a class="reference internal" href="../../rados/configuration/mclock-config-ref/#override-max-iops-capacity"><span class="std std-ref">Set or Override Max IOPS Capacity of an OSD</span></a></p></li>
</ul>
</li>
<li><p>pybind/rados: Fixes <code class="docutils literal notranslate"><span class="pre">WriteOp.zero()</span></code> in the original reversed order of arguments
<code class="docutils literal notranslate"><span class="pre">offset</span></code> and <code class="docutils literal notranslate"><span class="pre">length</span></code>. When pybind calls <code class="docutils literal notranslate"><span class="pre">WriteOp.zero()</span></code>, the argument passed
does not match <code class="docutils literal notranslate"><span class="pre">rados_write_op_zero</span></code>, and offset and length are swapped, which
results in an unexpected response.</p></li>
</ul>
</section>
<section id="rbd">
<h3>RBD<a class="headerlink" href="#rbd" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>RBD images can now be instantly imported from another Ceph cluster. The
migration source spec for <code class="docutils literal notranslate"><span class="pre">native</span></code> format has grown <code class="docutils literal notranslate"><span class="pre">cluster_name</span></code> and
<code class="docutils literal notranslate"><span class="pre">client_name</span></code> optional fields for connecting to the source cluster after
parsing the respective <code class="docutils literal notranslate"><span class="pre">ceph.conf</span></code>-like configuration file.</p></li>
<li><p>With the help of the new NBD stream (<code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:</span> <span class="pre">&quot;nbd&quot;</span></code>), RBD images can now
be instantly imported from a wide variety of external sources/formats. The
exact set of supported formats and their features depends on the capabilities
of the NBD server.</p></li>
<li><p>While mirroring between Ceph clusters, the local and remote RBD namespaces
don’t need to be the same anymore (but the pool names still do). Using the
new <code class="docutils literal notranslate"><span class="pre">--remote-namespace</span></code> option of <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">mirror</span> <span class="pre">pool</span> <span class="pre">enable</span></code> command, it’s
now possible to pair a local namespace with an arbitrary remote namespace in
the respective pool, including mapping a default namespace to a non-default
namespace and vice versa, at the time mirroring is configured.</p></li>
<li><p>All Python APIs that produce timestamps now return “aware” <code class="docutils literal notranslate"><span class="pre">datetime</span></code>
objects instead of “naive” ones (i.e., those including time zone information
instead of those not including it). All timestamps remain in UTC, but
including <code class="docutils literal notranslate"><span class="pre">timezone.utc</span></code> makes it explicit and avoids the potential of the
returned timestamp getting misinterpreted. In Python 3, many <code class="docutils literal notranslate"><span class="pre">datetime</span></code>
methods treat “naive” <code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects as local times.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">group</span> <span class="pre">info</span></code> and <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">group</span> <span class="pre">snap</span> <span class="pre">info</span></code> commands are introduced to
show information about a group and a group snapshot respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">group</span> <span class="pre">snap</span> <span class="pre">ls</span></code> output now includes the group snapshot IDs. The header
of the column showing the state of a group snapshot in the unformatted CLI
output is changed from <code class="docutils literal notranslate"><span class="pre">STATUS</span></code> to <code class="docutils literal notranslate"><span class="pre">STATE</span></code>. The state of a group snapshot
that was shown as <code class="docutils literal notranslate"><span class="pre">ok</span></code> is now shown as <code class="docutils literal notranslate"><span class="pre">complete</span></code>, which is more
descriptive.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">mirror</span> <span class="pre">image</span> <span class="pre">status</span></code> and <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">mirror</span> <span class="pre">pool</span> <span class="pre">status</span> <span class="pre">--verbose</span></code>
outputs, <code class="docutils literal notranslate"><span class="pre">mirror_uuids</span></code> field has been renamed to <code class="docutils literal notranslate"><span class="pre">mirror_uuid</span></code> to
highlight that the value is always a single UUID and never a list of any
kind.</p></li>
<li><p>Moving an image that is a member of a group to trash is no longer
allowed. The <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">trash</span> <span class="pre">mv</span></code> command now behaves the same way as <code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">rm</span></code>
in this scenario.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbd</span> <span class="pre">device</span> <span class="pre">map</span></code> command now defaults to <code class="docutils literal notranslate"><span class="pre">msgr2</span></code> for all device types.
<code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">ms_mode=legacy</span></code> can be passed to continue using <code class="docutils literal notranslate"><span class="pre">msgr1</span></code> with krbd.</p></li>
<li><p>The family of diff-iterate APIs has been extended to allow diffing from or
between non-user type snapshots which can only be referred to by their IDs.</p></li>
<li><p>Fetching the mirroring mode of an image is invalid if the image is
disabled for mirroring. The public APIs -- C++ <code class="docutils literal notranslate"><span class="pre">mirror_image_get_mode()</span></code>,
C <code class="docutils literal notranslate"><span class="pre">rbd_mirror_image_get_mode()</span></code>, and Python <code class="docutils literal notranslate"><span class="pre">Image.mirror_image_get_mode()</span></code>
-- will return <code class="docutils literal notranslate"><span class="pre">EINVAL</span></code> when mirroring is disabled.</p></li>
<li><p>Promoting an image is invalid if the image is not enabled for mirroring.
The public APIs -- C++ <code class="docutils literal notranslate"><span class="pre">mirror_image_promote()</span></code>,
C <code class="docutils literal notranslate"><span class="pre">rbd_mirror_image_promote()</span></code>, and Python <code class="docutils literal notranslate"><span class="pre">Image.mirror_image_promote()</span></code>
-- will return EINVAL instead of ENOENT when mirroring is not enabled.</p></li>
<li><p>Requesting a resync on an image is invalid if the image is not enabled
for mirroring. The public APIs -- C++ <code class="docutils literal notranslate"><span class="pre">mirror_image_resync()</span></code>,
C <code class="docutils literal notranslate"><span class="pre">rbd_mirror_image_resync()</span></code>, and Python <code class="docutils literal notranslate"><span class="pre">Image.mirror_image_resync()</span></code>
-- will return EINVAL instead of ENOENT when mirroring is not enabled.</p></li>
</ul>
</section>
<section id="rgw">
<h3>RGW<a class="headerlink" href="#rgw" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Multiple fixes: Lua scripts will no longer run uselessly against health checks,
properly quoted <code class="docutils literal notranslate"><span class="pre">ETag</span></code> values returned by S3 <code class="docutils literal notranslate"><span class="pre">CopyPart</span></code>, <code class="docutils literal notranslate"><span class="pre">PostObject</span></code>, and
<code class="docutils literal notranslate"><span class="pre">CompleteMultipartUpload</span></code> responses.</p></li>
<li><p>IAM policy evaluation now supports conditions <code class="docutils literal notranslate"><span class="pre">ArnEquals</span></code> and <code class="docutils literal notranslate"><span class="pre">ArnLike</span></code>,
along with their <code class="docutils literal notranslate"><span class="pre">Not</span></code> and <code class="docutils literal notranslate"><span class="pre">IfExists</span></code> variants.</p></li>
<li><p>Added BEAST frontend option <code class="docutils literal notranslate"><span class="pre">so_reuseport</span></code> which facilitates running multiple
RGW instances on the same host by sharing a single TCP port.</p></li>
<li><p>Replication policies now validate permissions using
<code class="docutils literal notranslate"><span class="pre">s3:ReplicateObject</span></code>, <code class="docutils literal notranslate"><span class="pre">s3:ReplicateDelete</span></code>, and <code class="docutils literal notranslate"><span class="pre">s3:ReplicateTags</span></code> for
destination buckets. For source buckets, both
<code class="docutils literal notranslate"><span class="pre">s3:GetObjectVersionForReplication</span></code> and <code class="docutils literal notranslate"><span class="pre">s3:GetObject(Version)</span></code> are
supported. Actions like <code class="docutils literal notranslate"><span class="pre">s3:GetObjectAcl</span></code>, <code class="docutils literal notranslate"><span class="pre">s3:GetObjectLegalHold</span></code>, and
<code class="docutils literal notranslate"><span class="pre">s3:GetObjectRetention</span></code> are also considered when fetching the source object.
Replication of tags is controlled by the
<code class="docutils literal notranslate"><span class="pre">s3:GetObject(Version)Tagging</span></code> permission.</p></li>
<li><p>Adding missing quotes to the <code class="docutils literal notranslate"><span class="pre">ETag</span></code> values returned by S3 <code class="docutils literal notranslate"><span class="pre">CopyPart</span></code>,
<code class="docutils literal notranslate"><span class="pre">PostObject</span></code>, and <code class="docutils literal notranslate"><span class="pre">CompleteMultipartUpload</span></code> responses.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PutObjectLockConfiguration</span></code> can now be used to enable S3 Object Lock on an
existing versioning-enabled bucket that was not created with Object Lock enabled.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">x-amz-confirm-remove-self-bucket-access</span></code> header is now supported by
<code class="docutils literal notranslate"><span class="pre">PutBucketPolicy</span></code>. Additionally, the root user will always have access to
modify the bucket policy, even if the current policy explicitly denies access.</p></li>
<li><p>Added support for the <code class="docutils literal notranslate"><span class="pre">RestrictPublicBuckets</span></code> property of the S3
<code class="docutils literal notranslate"><span class="pre">PublicAccessBlock</span></code> configuration.</p></li>
<li><p>The HeadBucket API now reports the <code class="docutils literal notranslate"><span class="pre">X-RGW-Bytes-Used</span></code> and <code class="docutils literal notranslate"><span class="pre">X-RGW-Object-Count</span></code>
headers only when the <code class="docutils literal notranslate"><span class="pre">read-stats</span></code> querystring is explicitly included in the
API request.</p></li>
</ul>
</section>
<section id="telemetry">
<h3>Telemetry<a class="headerlink" href="#telemetry" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">basic</span></code> channel in telemetry now captures the <code class="docutils literal notranslate"><span class="pre">ec_optimizations</span></code>
flag, which will allow us to gauge feature adoption for the new
FastEC improvements.
To opt into telemetry, run <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">telemetry</span> <span class="pre">on</span></code>.</p></li>
</ul>
</section>
<section id="upgrading-from-reef-or-squid">
<h3>Upgrading from Reef or Squid<a class="headerlink" href="#upgrading-from-reef-or-squid" title="Permalink to this heading"></a></h3>
<p>Before starting, ensure that your cluster is stable and healthy with no
<code class="docutils literal notranslate"><span class="pre">down</span></code>, <code class="docutils literal notranslate"><span class="pre">recovering</span></code>, <code class="docutils literal notranslate"><span class="pre">incomplete</span></code>, <code class="docutils literal notranslate"><span class="pre">undersized</span></code> or <code class="docutils literal notranslate"><span class="pre">backfilling</span></code> PGs.
You can temporarily disable the PG autoscaler for all pools during the upgrade
by running <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">pool</span> <span class="pre">set</span> <span class="pre">noautoscale</span></code> before beginning, and if the
autoscaler is desired after completion, running <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">osd</span> <span class="pre">pool</span> <span class="pre">unset</span>
<span class="pre">noautoscale</span></code> after upgrade success is confirmed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can monitor the progress of your upgrade at each stage with the <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">versions</span></code> command, which will tell you what Ceph version(s) are running for each type of daemon.</p>
</div>
</section>
<section id="upgrading-cephadm-clusters">
<h3>Upgrading Cephadm Clusters<a class="headerlink" href="#upgrading-cephadm-clusters" title="Permalink to this heading"></a></h3>
<p>If your cluster is deployed with cephadm (first introduced in Octopus), then the upgrade process is entirely automated. To initiate the upgrade,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "# ";
}
</style><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>upgrade<span class="w"> </span>start<span class="w"> </span>--image<span class="w"> </span>quay.io/ceph/ceph:v20.2.0</span>
</pre></div></div><p>The same process is used to upgrade to future minor releases.</p>
<p>Upgrade progress can be monitored with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>upgrade<span class="w"> </span>status</span>
</pre></div></div><p>Upgrade progress can also be monitored with <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">-s</span></code> (which provides a simple progress bar) or more verbosely with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>-W<span class="w"> </span>cephadm</span>
</pre></div></div><p>The upgrade can be paused or resumed with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>upgrade<span class="w"> </span>pause<span class="w">  </span><span class="c1"># to pause</span></span>
<span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>upgrade<span class="w"> </span>resume<span class="w"> </span><span class="c1"># to resume</span></span>
</pre></div></div><p>or canceled with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>orch<span class="w"> </span>upgrade<span class="w"> </span>stop</span>
</pre></div></div><p>Note that canceling the upgrade simply stops the process. There is no ability to downgrade back to Reef or Squid.</p>
</section>
<section id="upgrading-non-cephadm-clusters">
<h3>Upgrading Non-cephadm Clusters<a class="headerlink" href="#upgrading-non-cephadm-clusters" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic">
<li><p>If your cluster is running Reef (18.2.x) or later, you might choose
to first convert it to use cephadm so that the upgrade to Tentacle is automated (see above).
For more information, see <a class="reference external" href="https://docs.ceph.com/en/tentacle/cephadm/adoption/">https://docs.ceph.com/en/tentacle/cephadm/adoption/</a>.</p></li>
<li><p>If your cluster is running Reef (18.2.x) or later, systemd unit file
names have changed to include the cluster fsid. To find the correct
systemd unit file name for your cluster, run following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="o">-</span><span class="n">l</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">&lt;</span><span class="n">daemon</span> <span class="nb">type</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt2:before {
  content: "$ ";
}
</style><span class="prompt2">systemctl<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mon<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>active</span>
</pre></div></div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ceph</span><span class="o">-</span><span class="mi">6</span><span class="n">ce0347c</span><span class="o">-</span><span class="mi">314</span><span class="n">a</span><span class="o">-</span><span class="mi">11</span><span class="n">ee</span><span class="o">-</span><span class="mi">9</span><span class="n">b52</span><span class="o">-</span><span class="mi">000</span><span class="n">af7995d6c</span><span class="nd">@mon</span><span class="o">.</span><span class="n">f28</span><span class="o">-</span><span class="n">h21</span><span class="o">-</span><span class="mi">000</span><span class="o">-</span><span class="n">r630</span><span class="o">.</span><span class="n">service</span>                                           <span class="n">loaded</span> <span class="n">active</span> <span class="n">running</span>   <span class="n">Ceph</span> <span class="n">mon</span><span class="o">.</span><span class="n">f28</span><span class="o">-</span><span class="n">h21</span><span class="o">-</span><span class="mi">000</span><span class="o">-</span><span class="n">r630</span> <span class="k">for</span> <span class="mi">6</span><span class="n">ce0347c</span><span class="o">-</span><span class="mi">314</span><span class="n">a</span><span class="o">-</span><span class="mi">11</span><span class="n">ee</span><span class="o">-</span><span class="mi">9</span><span class="n">b52</span><span class="o">-</span><span class="mi">000</span><span class="n">af7995d6c</span>
</pre></div>
</div>
</li>
</ol>
</div>
<ol class="arabic">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">noout</span></code> flag for the duration of the upgrade. (Optional, but recommended.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span><span class="nb">set</span><span class="w"> </span>noout</span>
</pre></div></div></li>
<li><p>Upgrade Monitors by installing the new packages and restarting the Monitor daemons. For example, on each Monitor host</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>restart<span class="w"> </span>ceph-mon.target</span>
</pre></div></div><p>Once all Monitors are up, verify that the Monitor upgrade is complete by looking for the <code class="docutils literal notranslate"><span class="pre">tentacle</span></code> string in the mon map. The command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>mon<span class="w"> </span>dump<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>min_mon_release</span>
</pre></div></div><p>should report:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">min_mon_release<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">(</span>tentacle<span class="o">)</span></span>
</pre></div></div><p>If it does not, that implies that one or more Monitors haven’t been upgraded and restarted and/or the quorum does not include all Monitors.</p>
</li>
<li><p>Upgrade <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> daemons by installing the new packages and restarting all Manager daemons. For example, on each Manager host,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>restart<span class="w"> </span>ceph-mgr.target</span>
</pre></div></div><p>Verify the <code class="docutils literal notranslate"><span class="pre">ceph-mgr</span></code> daemons are running by checking <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">-s</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>-s</span>
</pre></div></div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
  <span class="n">services</span><span class="p">:</span>
   <span class="n">mon</span><span class="p">:</span> <span class="mi">3</span> <span class="n">daemons</span><span class="p">,</span> <span class="n">quorum</span> <span class="n">foo</span><span class="p">,</span><span class="n">bar</span><span class="p">,</span><span class="n">baz</span>
   <span class="n">mgr</span><span class="p">:</span> <span class="n">foo</span><span class="p">(</span><span class="n">active</span><span class="p">),</span> <span class="n">standbys</span><span class="p">:</span> <span class="n">bar</span><span class="p">,</span> <span class="n">baz</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>Upgrade all OSDs by installing the new packages and restarting the <code class="docutils literal notranslate"><span class="pre">ceph-osd</span></code> daemons on all OSD hosts</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>restart<span class="w"> </span>ceph-osd.target</span>
</pre></div></div></li>
<li><p>Upgrade all CephFS MDS daemons. For each CephFS file system,</p>
<ol class="arabic">
<li><p>Disable standby_replay:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;fs_name&gt;<span class="w"> </span>allow_standby_replay<span class="w"> </span><span class="nb">false</span></span>
</pre></div></div></li>
<li><p>Reduce the number of ranks to 1. (Make note of the original number of MDS daemons first if you plan to restore it later.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>status<span class="w"> </span><span class="c1"># ceph fs set &lt;fs_name&gt; max_mds 1</span></span>
</pre></div></div></li>
<li><p>Wait for the cluster to deactivate any non-zero ranks by periodically checking the status</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>status</span>
</pre></div></div></li>
<li><p>Take all standby MDS daemons offline on the appropriate hosts with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>stop<span class="w"> </span>ceph-mds@&lt;daemon_name&gt;</span>
</pre></div></div></li>
<li><p>Confirm that only one MDS is online and is rank 0 for your FS</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>status</span>
</pre></div></div></li>
<li><p>Upgrade the last remaining MDS daemon by installing the new packages and restarting the daemon</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>restart<span class="w"> </span>ceph-mds.target</span>
</pre></div></div></li>
<li><p>Restart all standby MDS daemons that were taken offline</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>start<span class="w"> </span>ceph-mds.target</span>
</pre></div></div></li>
<li><p>Restore the original value of <code class="docutils literal notranslate"><span class="pre">max_mds</span></code> for the volume</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>fs<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;fs_name&gt;<span class="w"> </span>max_mds<span class="w"> </span>&lt;original_max_mds&gt;</span>
</pre></div></div></li>
</ol>
</li>
<li><p>Upgrade all <code class="docutils literal notranslate"><span class="pre">radosgw</span></code> daemons by upgrading packages and restarting daemons on all hosts</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">systemctl<span class="w"> </span>restart<span class="w"> </span>ceph-radosgw.target</span>
</pre></div></div></li>
<li><p>Complete the upgrade by disallowing pre-Tentacle OSDs and enabling all new Tentacle-only functionality</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span>require-osd-release<span class="w"> </span>tentacle</span>
</pre></div></div></li>
<li><p>If you set <code class="docutils literal notranslate"><span class="pre">noout</span></code> at the beginning, be sure to clear it with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>osd<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>noout</span>
</pre></div></div></li>
<li><p>Consider transitioning your cluster to use the cephadm deployment and orchestration framework to simplify
cluster management and future upgrades. For more information on converting an existing cluster to cephadm,
see <a class="reference internal" href="../../cephadm/adoption/#cephadm-adoption"><span class="std std-ref">现有集群切换到 cephadm</span></a>.</p></li>
</ol>
</section>
<section id="post-upgrade">
<h3>Post-upgrade<a class="headerlink" href="#post-upgrade" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Verify the cluster is healthy with <code class="docutils literal notranslate"><span class="pre">ceph</span> <span class="pre">health</span></code>.</p></li>
<li><p>Consider enabling the <a class="reference internal" href="../../mgr/telemetry/#telemetry"><span class="std std-ref">Telemetry Module</span></a> to send anonymized usage statistics
and crash information to Ceph upstream developers. To see what would
be reported without actually sending any information to anyone,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>telemetry<span class="w"> </span>preview-all</span>
</pre></div></div><p>If you are comfortable with the data that is reported, you can opt-in to automatically report high-level cluster metadata with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">ceph<span class="w"> </span>telemetry<span class="w"> </span>on</span>
</pre></div></div><p>The public dashboard that aggregates Ceph telemetry can be found at <a class="reference external" href="https://telemetry-public.ceph.com/">https://telemetry-public.ceph.com/</a>.</p>
</li>
</ol>
</section>
<section id="upgrading-from-pre-reef-releases-like-quincy">
<h3>Upgrading from Pre-Reef Releases (like Quincy)<a class="headerlink" href="#upgrading-from-pre-reef-releases-like-quincy" title="Permalink to this heading"></a></h3>
<p>You <strong>must</strong> first upgrade to Reef (18.2.z) or Squid (19.2.z) before upgrading to Tentacle.</p>
</section>
</section>
</section>



<div id="support-the-ceph-foundation" class="admonition note">
  <p class="first admonition-title">Brought to you by the Ceph Foundation</p>
  <p class="last">The Ceph Documentation is a community resource funded and hosted by the non-profit <a href="https://ceph.io/en/foundation/">Ceph Foundation</a>. If you would like to support this and our other efforts, please consider <a href="https://ceph.io/en/foundation/join/">joining now</a>.</p>
</div>


           </div>
           
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../" class="btn btn-neutral float-left" title="Ceph 版本（索引）" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../squid/" class="btn btn-neutral float-right" title="Squid" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, Ceph authors and contributors. Licensed under Creative Commons Attribution Share Alike 3.0 (CC-BY-SA-3.0).</p>
  </div>

   

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>